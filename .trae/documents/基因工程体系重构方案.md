# 基因工程体系重构方案

## 一、现状问题

1. **序列太短**：当前序列长度仅12-30位，无法体现基因工程的深度
2. **层级缺失**：只有碱基编辑，缺少脱氧核苷酸、DNA双链、染色体等层级
3. **突变诱导无意义**：随机改变碱基没有策略价值，建议移除

## 二、新体系架构

### 2.1 层级结构

```
染色体 (Chromosome) - 最高层级
├── DNA双链 (DNA Strand) - 双螺旋结构
│   ├── 正义链 (Sense Strand)
│   └── 反义链 (Antisense Strand)
│       └── 脱氧核苷酸 (Nucleotide) - 基本单位
│           ├── 磷酸基团
│           ├── 脱氧核糖
│           └── 含氮碱基 (A/T/G/C)
└── 基因片段 (Gene Fragment) - 功能单元
```

### 2.2 各层级说明

| 层级 | 数量 | 容量 | 说明 |
|------|------|------|------|
| 染色体 | 1-2条 | 每条含2条DNA链 | 随基因等级解锁 |
| DNA链 | 2-4条 | 每条100-500个核苷酸 | 双链配对 |
| 脱氧核苷酸 | 200-2000个 | - | 可编辑的基本单位 |
| 基因片段 | 动态识别 | - | 特定序列组合触发效果 |

### 2.3 DNA双链配对规则

遵循真实生物学规则：
- A（腺嘌呤）↔ T（胸腺嘧啶）
- G（鸟嘌呤）↔ C（胞嘧啶）

```
正义链：  A - T - G - C - A - T - G - C
          │   │   │   │   │   │   │   │
反义链：  T - A - C - G - T - A - C - G
```

## 三、详细设计

### 3.1 脱氧核苷酸（Nucleotide）

```typescript
interface Nucleotide {
  id: string;
  base: BasePair;           // 碱基 A/T/G/C
  position: number;         // 在链中的位置
  paired: boolean;          // 是否已配对
  modified: boolean;        // 是否被修饰（突变/强化）
}
```

**编辑操作**：
- 替换单个碱基（消耗：基因材料×5 + 信用点×1000）
- 批量替换（消耗按数量递增）

### 3.2 DNA双链（DNA Strand）

```typescript
interface DNAStrand {
  id: string;
  type: 'sense' | 'antisense';  // 正义链/反义链
  nucleotides: Nucleotide[];     // 核苷酸序列
  length: number;                // 当前长度
  maxLength: number;             // 最大长度
  integrity: number;             // 完整度 0-100%
}
```

**配对机制**：
- 正义链编辑后，反义链自动配对
- 配对完整度影响基因表达效率
- 可以单独编辑反义链（高级功能）

### 3.3 染色体（Chromosome）

```typescript
interface Chromosome {
  id: string;
  name: string;                  // 如"力量染色体"、"生命染色体"
  senseStrand: DNAStrand;        // 正义链
  antisenseStrand: DNAStrand;    // 反义链
  unlocked: boolean;             // 是否解锁
  geneSlots: number;             // 可容纳基因片段数
}
```

**解锁条件**：
| 染色体 | 解锁条件 | 容量 | 特性 |
|--------|----------|------|------|
| 基础染色体 | 初始解锁 | 200核苷酸 | 通用基因 |
| 力量染色体 | 基因Lv.2 | 300核苷酸 | 攻击类基因+20%效果 |
| 生命染色体 | 基因Lv.3 | 400核苷酸 | 生命类基因+20%效果 |
| 特殊染色体 | 基因Lv.5 | 500核苷酸 | 稀有基因出现率+10% |

### 3.4 基因片段识别升级

由于序列变长，基因片段识别规则需要调整：

| 原序列长度 | 新序列长度 | 调整方案 |
|------------|------------|----------|
| 3-12位 | 10-50位 | 基因片段模式延长 |

**示例**：
```
原吸血本能：TATA (4位)
新吸血本能：TATA-TATA-GCGC (12位) - 需要更长序列触发
```

## 四、UI界面设计

### 4.1 主界面布局

```
┌─────────────────────────────────────────────────────────────┐
│  🧬 基因工程 Lv.3                                           │
├─────────────────────────────────────────────────────────────┤
│  染色体选择：[基础] [力量🔒] [生命🔒] [特殊🔒]              │
├─────────────────────────────────────────────────────────────┤
│  DNA双链视图                                                │
│  ┌─────────────────────────────────────────────────────┐    │
│  │ 正义链：ATGCATGCATGCATGCATGCATGCATGCATGC...         │    │
│  │         ││││││││││││││││││││││││││││││             │    │
│  │ 反义链：TACGTACGTACGTACGTACGTACGTACGTACG...         │    │
│  └─────────────────────────────────────────────────────┘    │
│  完整度：98%  |  已识别基因：5个                             │
├─────────────────────────────────────────────────────────────┤
│  [编辑碱基]  [查看基因]  [帮助手册]                         │
└─────────────────────────────────────────────────────────────┘
```

### 4.2 编辑界面

```
┌─────────────────────────────────────────────────────────────┐
│  编辑位置：第 15 位                                         │
│  当前碱基：A (腺嘌呤)                                       │
│  配对碱基：T (胸腺嘧啶)                                     │
├─────────────────────────────────────────────────────────────┤
│  选择新碱基：                                               │
│  [A 腺嘌呤] [T 胸腺嘧啶] [G 鸟嘌呤] [C 胞嘧啶]             │
├─────────────────────────────────────────────────────────────┤
│  ⚠️ 修改后反义链将自动配对                                  │
│  消耗：基因材料×5 + 信用点×1000                             │
└─────────────────────────────────────────────────────────────┘
```

## 五、实现步骤

### 5.1 数据结构重构
1. 新增 `Nucleotide` 接口
2. 新增 `DNAStrand` 接口
3. 新增 `Chromosome` 接口
4. 更新 `GeneSequence` 为包含染色体的结构

### 5.2 核心功能实现
1. DNA双链配对逻辑
2. 染色体解锁系统
3. 基因片段识别适配长序列
4. 完整度计算

### 5.3 UI组件开发
1. DNA双链可视化组件
2. 染色体选择组件
3. 编辑界面升级
4. 手册更新

### 5.4 移除功能
1. 移除突变诱导功能
2. 清理相关代码和UI

## 六、数值设计

### 6.1 序列长度

| 基因等级 | 染色体数 | 每条长度 | 总核苷酸数 |
|----------|----------|----------|------------|
| Lv.1 | 1 | 200 | 400（双链） |
| Lv.2 | 1 | 300 | 600 |
| Lv.3 | 2 | 300 | 1200 |
| Lv.4 | 2 | 400 | 1600 |
| Lv.5 | 2 | 500 | 2000 |

### 6.2 基因片段模式延长

| 原模式 | 新模式 | 长度 |
|--------|--------|------|
| TATA | TATATATAGCGC | 12 |
| AAA | AAAAAAGGGGGG | 12 |
| GGG | GGGGGGCCCCCC | 12 |
| GCGC | GCGCGCATATAT | 12 |

## 七、预期效果

1. **深度增加**：从单一碱基编辑升级为完整基因工程体系
2. **策略性增强**：染色体选择、双链配对增加策略维度
3. **可扩展性**：未来可添加基因突变、染色体融合等高级功能
4. **科学性**：贴近真实生物学概念，增加代入感
